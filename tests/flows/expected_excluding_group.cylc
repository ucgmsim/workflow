[scheduling]
    [[graph]]
        R1 = """
        check_domain_Darfield => emod3d_Darfield
        check_srf_Darfield => check_domain_Darfield
        copy_input => check_srf_Darfield
        emod3d_Darfield => merge_ts_Darfield
        merge_ts_Darfield => plot_ts_Darfield
        """
    [runtime]
    [[root]]
        platform = mahuika-slurm
        pre-script = """
        module load Apptainer
        """
        [[[directives]]]
                --account = nesi00213
    [[check_domain_Darfield]]
        script = apptainer exec -c --bind "$PWD:/out,$CYLC_WORKFLOW_SHARE_DIR/Darfield:/share,$CYLC_WORKFLOW_SHARE_DIR/Darfield:/parent" /nesi/nobackup/nesi00213/containers/runner_latest.sif check-domain /share/realisation.json /share/realisation.srf /parent/Velocity_Model
    [[check_srf_Darfield]]
        script = apptainer exec -c --bind "$PWD:/out,$CYLC_WORKFLOW_SHARE_DIR/Darfield:/share" /nesi/nobackup/nesi00213/containers/runner_latest.sif check-srf /share/realisation.json /share/realisation.srf
    [[copy_input]]
        platform = localhost
        script = "[[ ! -d $CYLC_WORKFLOW_RUN_DIR/input ]] || cp -rn $CYLC_WORKFLOW_RUN_DIR/input/. $CYLC_WORKFLOW_SHARE_DIR"
    [[emod3d_Darfield]]
        pre-script = module load foss/2023a
        script = srun /nesi/project/nesi00213/opt/EMOD3D_cylc/tools/emod3d-mpi_v3.0.8 -args "par=$CYLC_WORKFLOW_SHARE_DIR/Darfield/LF/e3d.par"
        [[[directives]]]
                --partition = milan
                --ntasks = 160
                --mem-per-cpu = 2000MB
                --nodes = 2
                --time = 06:00:00
    [[merge_ts_Darfield]]
        script = apptainer exec -c --bind "$PWD:/out,$CYLC_WORKFLOW_SHARE_DIR:/share/Darfield" merge-ts /share/LF/OutBin /share/LF/OutBin/output.e3d
    [[plot_ts_Darfield]]
        script = apptainer exec -c --bind "$PWD:/out,$CYLC_WORKFLOW_SHARE_DIR:/share/Darfield" plot-ts /share/LF/OutBin/output.e3d /share/animation.mp4